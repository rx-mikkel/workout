<!doctype html>
<html lang="en-UK">
	<head>
		<title>Quick workout generator</title>
		<link rel="stylesheet" href="styles/index.css">
		<meta charset="UTF-8">
		<meta name="title" content="Workout generator">
		<meta name="description" content="Generate a workout for your current shape, your fitness knowledge and equipment">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
		<script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
		<link rel="manifest" href="manifest.json" />
	</head>
	<body x-data="{ settingsMenuOpen: $persist(true) }">
		<header class="band">
			<div class="content">
				<button title="Settings" class="settingsButton" :class="{ 'transparent' : settingsMenuOpen === true }" x-on:click="settingsMenuOpen = true">
					<div class="settingsButtonContent">
						<div class="caption">Settings</div>
						<div class="settingsRing">
							<div class="settingsToothContainer">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate30">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate60">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate90">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate120">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate150">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate180">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate210">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate240">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate270">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate300">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsToothContainer rotate330">
								<div class="settingsTooth"></div>
							</div>
							<div class="settingsRingDetail"></div>
						</div>
					</div>
				</button>
			</div>
		</header>
		<div class="band settings" x-show="settingsMenuOpen">
			<div class="content">
				<div class="settingsSection" x-data="{ workoutCapacity: $persist(1) }">
					<h2>Are you used to working out?</h2>
					<p>This determines how many rounds, repetitions and exercises to give you.</p>
					<p>Start low if you are new or had a longer break. You will move this slider soon enough!</p>
					<button x-on:click="workoutCapacity = 0" :class="{ 'active': workoutCapacity === 0 }">A little</button>
					<button x-on:click="workoutCapacity = 1" :class="{ 'active': workoutCapacity === 1 }">A decent amount</button>
					<button x-on:click="workoutCapacity = 2" :class="{ 'active': workoutCapacity === 2 }">A lot</button>
				</div>
				<div class="settingsSection" x-data="{ workoutExperience: $persist(1) }">
					<h2>How experienced are you?</h2>
					<p>Determines how advanced the exercises can be.<br>We recommend working out with others - at least some of the time - to improve your form, avoid injury and have fun!</p>
					<button x-on:click="workoutExperience = 0" :class="{ 'active': workoutExperience === 0 }">Beginner</button>
					<button x-on:click="workoutExperience = 1" :class="{ 'active': workoutExperience === 1 }">Intermediate</button>
					<button x-on:click="workoutExperience = 2" :class="{ 'active': workoutExperience === 2 }">Expert</button>
				</div>
				<div class="settingsSection" x-data="{ kettlebell: $persist(false), barbell: $persist(false) }">
					<h2>Equipment</h2>
					<button x-on:click="kettlebell = ! kettlebell" :class="{ 'active': kettlebell === true }">Kettlebell</button>
					<button x-on:click="barbell = ! barbell" :class="{ 'active': barbell === true }">Barbell</button>
				</div>
				<div class="saveSettings">
					<button x-on:click="settingsMenuOpen = false">Save and close</button>
				</div>
			</div>
		</div>
		<div class="band workout" x-data="workout()">
			<div class="content" :class="{ 'ice' : settingsMenuOpen }" x-data="{ diceRolled: false }">
				<div class="dice" :class="{ 'bigDice': !diceRolled }">
					<button class="diceButton" @click="generateWorkout(), diceRolled = true">
						<div class="scene">
							<div class="cube show-left">
								<div class="cube-face front">
									<div class="exercise-avatar">
										<div class="bbdeadlift">
											<div class="barbell">
												<div class="plate left"></div>
												<div class="plate left-inner"></div>
												<div class="plate right-inner"></div>
												<div class="plate right"></div>
											</div>
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face back">
									<div class="exercise-avatar">
										<div class="bbdeadlift">
											<div class="barbell">
												<div class="plate left"></div>
												<div class="plate left-inner"></div>
												<div class="plate right-inner"></div>
												<div class="plate right"></div>
											</div>
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face right">
									<div class="exercise-avatar">
										<div class="lunge">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face left">
									<div class="exercise-avatar">
										<div class="lunge">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face top">
									<div class="exercise-avatar">
										<div class="squat">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face bottom">
									<div class="exercise-avatar">
										<div class="squat">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="cube show-front">
								<div class="cube-face front">
									<div class="exercise-avatar">
										<div class="burpee">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face back">
									<div class="exercise-avatar">
										<div class="burpee">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face right">
									<div class="exercise-avatar">
										<div class="bbdeadlift">
											<div class="barbell">
												<div class="plate left"></div>
												<div class="plate left-inner"></div>
												<div class="plate right-inner"></div>
												<div class="plate right"></div>
											</div>
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face left">
									<div class="exercise-avatar">
										<div class="bbdeadlift">
											<div class="barbell">
												<div class="plate left"></div>
												<div class="plate left-inner"></div>
												<div class="plate right-inner"></div>
												<div class="plate right"></div>
											</div>
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face top">
									<div class="exercise-avatar">
										<div class="squat">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="cube-face bottom">
									<div class="exercise-avatar">
										<div class="squat">
											<div class="body">
												<div class="head"></div>
												<div class="arm left-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="arm right-arm">
													<div class="arm underarm"></div>
												</div>
												<div class="leg left-leg">
													<div class="leg lower-leg"></div>
												</div>
												<div class="leg right-leg">
													<div class="leg lower-leg"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</button>
					<!--
						<h2 class="dice-instruction">Roll the dice!</h2>
					-->
					
				</div>
				<template x-if="diceRolled">
					<div class="workoutResult">
						<div class="wod">
							<div class="rounds">
								<h2><span x-text="rounds"></span><span class="times"> x</span></h2>
							</div>
							<div class="exerciseList">
								<template x-for="exercise in todaysWorkout">
									<div class="wodEntry">
										<h4><span x-text="exercise.baseRounds"></span><span class="times"> x</span></h4>
										<div class="exercise" :class="exercise.intensity">
											<div class="exercise-avatar">
												<div :class="exercise.id">
													<div class="barbell">
														<div class="plate left"></div>
														<div class="plate left-inner"></div>
														<div class="plate right-inner"></div>
														<div class="plate right"></div>
													</div>
													<div class="body">
														<div class="head"></div>
														<div class="arm left-arm">
															<div class="arm underarm"></div>
														</div>
														<div class="arm right-arm">
															<div class="arm underarm"></div>
														</div>
														<div class="leg left-leg">
															<div class="leg lower-leg"></div>
														</div>
														<div class="leg right-leg">
															<div class="leg lower-leg"></div>
														</div>
													</div>
												</div>
											</div>
											<p x-text="exercise.name"></p>
										</div>
									</div>
								</template>
							</div>
						</div>
					</div>
				</template>
			</div>
		</div>
	</body>

	<script type="text/javascript">
		function workout() {
			return {
				rounds: null,
				todaysWorkout: null,
				generateWorkout() {
					let capacity = localStorage.getItem("_x_workoutCapacity");

					const workoutDifficulties = [
						{
							rounds: [2, 3, 3, 4],
							exercises: [2, 3, 3, 4]
						},
						{
							rounds: [3, 4, 4],
							exercises: [3, 4]
						},
						{
							rounds: [3, 4, 5],
							exercises: [3, 4, 5]
						}
					];

					let skill = localStorage.getItem("_x_workoutExperience");

					// resolves to a string... not ideal
					let enableKettlebell = localStorage.getItem("_x_kettlebell");
					let enableBarbell = localStorage.getItem("_x_barbell");

					let currentWorkoutDifficulty = workoutDifficulties[capacity];

					const randRounds = getRandomArrayIndex(currentWorkoutDifficulty.rounds);

					this.rounds = currentWorkoutDifficulty.rounds[randRounds];

					const simpleExercises = [
						{
							name: 'Squat',
							id: 'squat',
							baseRounds: 18,
							intensity: 'intensity3',
							skillLevel: 1,
						},
						{
							name: 'Burpee',
							id: 'burpee',
							baseRounds: 9,
							intensity: 'intensity4',
							skillLevel: 1,
						},
						{
							name: 'Push-up',
							id: 'pushup',
							baseRounds: 12,
							intensity: 'intensity2',
							skillLevel: 1,
						},
						{
							name: 'Jump squat',
							id: 'jumpsquat',
							baseRounds: 14,
							intensity: 'intensity4',
							skillLevel: 1,
						},
						{
							name: 'Lunge',
							id: 'lunge',
							baseRounds: 12,
							intensity: 'intensity2',
							skillLevel: 1,
						},
						{
							name: 'Glute bridge',
							id: 'glutebridge',
							baseRounds: 12,
							intensity: 'intensity2',
							skillLevel: 1,
						},
						{
							name: 'Mountain climber',
							id: 'mountainclimber',
							baseRounds: 16,
							intensity: 'intensity3',
							skillLevel: 2,
						},
						{
							name: 'Tricep dip',
							id: 'tricepdip',
							baseRounds: 10,
							intensity: 'intensity2',
							skillLevel: 2,
						},
						{
							name: 'Plank reach-under',
							id: 'plankreachunder',
							baseRounds: 12,
							intensity: 'intensity2',
							skillLevel: 1,
						},
						{
							name: 'Step-up',
							id: 'stepup',
							baseRounds: 12,
							intensity: 'intensity2',
							skillLevel: 1,
						},
					];

					const kettlebellExercises = [
						{
							name: 'Kettlebell Swing',
							id: 'kbswing',
							baseRounds: 12,
							intensity: 'intensity3',
							skillLevel: 1,
						},
						{
							name: 'Goblet Squat',
							id: 'kbgobletsquat',
							baseRounds: 8,
							intensity: 'intensity3',
							skillLevel: 1,
						},
						{
							name: 'Push-press',
							id: 'kbpushpress',
							baseRounds: 8,
							intensity: 'intensity1',
							skillLevel: 1,
						},
						{
							name: 'Weighted Lunge',
							id: 'kbweightedlunge',
							baseRounds: 12,
							intensity: 'intensity2',
							skillLevel: 1,
						},
						{
							name: 'Turkish getup',
							id: 'kbturkishgetup',
							baseRounds: 5,
							intensity: 'intensity2',
							skillLevel: 3,
						},
						{
							name: 'Deadlift',
							id: 'kbdeadlift',
							baseRounds: 8,
							intensity: 'intensity1',
							skillLevel: 1,
						},
					];

					const barbellExercises = [
						{
							name: 'Back Squat',
							id: 'bbbacksquat',
							baseRounds: 12,
							intensity: 'intensity1',
							skillLevel: 1,
						},
						{
							name: 'Front Squat',
							id: 'bbfrontsquat',
							baseRounds: 10,
							intensity: 'intensity2',
							skillLevel: 2,
						},
						{
							name: 'Overhead Squat',
							id: 'bboverheadsquat',
							baseRounds: 8,
							intensity: 'intensity2',
							skillLevel: 3,
						},
						{
							name: 'Push-press',
							id: 'bbpushpress',
							baseRounds: 8,
							intensity: 'intensity2',
							skillLevel: 1,
						},
						{
							name: 'Deadlift',
							id: 'bbdeadlift',
							baseRounds: 8,
							intensity: 'intensity1',
							skillLevel: 1,
						},
						{
							name: 'Clean',
							id: 'bbclean',
							baseRounds: 8,
							intensity: 'intensity2',
							skillLevel: 2,
						},
						{
							name: 'Snatch',
							id: 'bbsnatch',
							baseRounds: 6,
							intensity: 'intensity3',
							skillLevel: 3,
						},
						{
							name: 'Clean & Jerk',
							id: 'bbcleanjerk',
							baseRounds: 8,
							intensity: 'intensity3',
							skillLevel: 3,
						},
					];

					const randExercises = getRandomArrayIndex(currentWorkoutDifficulty.exercises);
					const numberOfExercisesToday = currentWorkoutDifficulty.exercises[randExercises];

					const todaysExercises = [];
					let exercisePool = structuredClone(simpleExercises);

					if (enableKettlebell == 'true') {
						exercisePool = exercisePool.concat(kettlebellExercises);
					}

					if (enableBarbell == 'true') {
						exercisePool = exercisePool.concat(barbellExercises);
					}

					exercisePool = exercisePool.filter((ex) => (ex.skillLevel - 1) <= skill);

					for (var index = 0; index < numberOfExercisesToday; index++) {
						let exerciseIndex = Math.floor((Math.random() * exercisePool.length));
						
						let exerciseEntry = exercisePool.splice(exerciseIndex, 1);
						let selectedExercise = exerciseEntry[0];

						if(capacity == 2) {
							selectedExercise.baseRounds = Math.floor(selectedExercise.baseRounds * 1.2)
						}

						const randomRepsVariation = Math.floor((Math.random() * 5)) - 3 + (capacity * 3);
						selectedExercise.baseRounds = (selectedExercise.baseRounds + randomRepsVariation);

						todaysExercises.push(selectedExercise);
					}

					this.todaysWorkout = todaysExercises;
				},
			};
		}

		function getRandomArrayIndex(array) {
			const arrIndex = Math.floor((Math.random() * array.length));
			return arrIndex;
		}
	</script>

	<script>
		if (!navigator.serviceWorker.controller) {
			navigator.serviceWorker.register("sw.js").then(function(reg) {
				console.log("Service worker has been registered for scope: " + reg.scope);
			});
		}
   </script>
	<!-- TODO:
		Add more workout icons
		Animate workout
		Animate workout icons on hover?
		
		Fix perspective in app icon
		Vectorize it
	-->
</html>

