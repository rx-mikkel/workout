<!doctype html>
<html>
	<head>
		<link rel="stylesheet" href="styles/index.css">
		<meta charset="UTF-8">
		<meta name="title" content="Workout generator">
		<meta name="description" content="Generate a workout for your current shape, your fitness knowledge and equipment">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
		<script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
	</head>
	<body x-data="{ settingsMenuOpen: $persist(true) }">
		<header class="band">
			<div class="content">
				<button :class="{ 'transparent' : settingsMenuOpen === true }" x-on:click="settingsMenuOpen = true">Settings</button>
			</div>
		</header>
		<div class="band settings" x-show="settingsMenuOpen">
			<div class="content">
				<div class="settingsSection" x-data="{ workoutCapacity: $persist(1) }">
					<h2>Are you used to working out?</h2>
					<p>This is used to determine how many rounds, repetitions and exercises to give you.</p>
					<p>Start low if you are new or had a longer break. You will move this slider soon enough!</p>
					<button x-on:click="workoutCapacity = 0" :class="{ 'active': workoutCapacity === 0 }">A little</button>
					<button x-on:click="workoutCapacity = 1" :class="{ 'active': workoutCapacity === 1 }">A decent amount</button>
					<button x-on:click="workoutCapacity = 2" :class="{ 'active': workoutCapacity === 2 }">A lot</button>
				</div>
				<div class="settingsSection" x-data="{ workoutExperience: $persist(1) }">
					<h2>How experienced are you?</h2>
					<p>This is used to determine how advanced the exercises can be.<br>We recommend working out with others - at least some of the time - and be open to suggestions about improving your form in order to stay healthy and avoid injury.<br>It is also a great opportunity to have fun!</p>
					<button x-on:click="workoutExperience = 0" :class="{ 'active': workoutExperience === 0 }">Beginner</button>
					<button x-on:click="workoutExperience = 1" :class="{ 'active': workoutExperience === 1 }">Intermediate</button>
					<button x-on:click="workoutExperience = 2" :class="{ 'active': workoutExperience === 2 }">Expert</button>
				</div>
				<div class="settingsSection" x-data="{ equipment: $persist([false,false]) }">
					<h2>Equipment</h2>
					<button x-on:click="equipment[0] = ! equipment[0]" :class="{ 'active': equipment[0] === true }">Kettlebell</button>
					<button x-on:click="equipment[1] = ! equipment[1]" :class="{ 'active': equipment[1] === true }">Barbell</button>
				</div>
				<div class="saveSettings">
					<button x-on:click="settingsMenuOpen = false">Save and close</button>
				</div>
			</div>
		</div>
		<div class="band workout" x-data="workout()">
			<div class="content" x-data="{ diceRolled: false }">
				<div class="dice" :class="{ 'bigDice': !diceRolled }">
					<button class="diceButton" @click="generateWorkout(), diceRolled = true">Roll</button>
				</div>
				<template x-if="diceRolled">
					<div class="workoutResult">
						<div class="wod">
							<div class="rounds">
								<h2 x-text="rounds + ' x'"></h2>
							</div>
							<div class="exerciseList">
								<template x-for="exercise in todaysWorkout">
									<div class="wodEntry">
										<h4 x-text="exercise.baseRounds + ' x'"></h4>
										<div class="exercise" :class="exercise.intensity"><p x-text="exercise.name"></p></div>
									</div>
								</template>
							</div>
						</div>
					</div>
				</template>
			</div>
		</div>
	</body>

	<script type="text/javascript">
		function workout() {
			return {
				rounds: null,
				todaysWorkout: null,
				generateWorkout() {
					let capacity = localStorage.getItem("_x_workoutCapacity");

					const workoutDifficulties = [
						{
							rounds: [2, 3, 4],
							exercises: [2, 3]
						},
						{
							rounds: [3, 4],
							exercises: [3, 4]
						},
						{
							rounds: [3, 4, 5],
							exercises: [3, 4, 5]
						}
					];

					let currentWorkoutDifficulty = workoutDifficulties[capacity];

					const randRounds = getRandomArrayIndex(currentWorkoutDifficulty.rounds);

					this.rounds = currentWorkoutDifficulty.rounds[randRounds];

					const simpleExercises = [
						{
							name: 'Squats',
							baseRounds: 16,
							intensity: 'intensity3'
						},
						{
							name: 'Burpees',
							baseRounds: 10,
							intensity: 'intensity4'
						},
						{
							name: 'Push-press',
							baseRounds: 10,
							intensity: 'intensity1'
						},
						{
							name: 'Push-ups',
							baseRounds: 12,
							intensity: 'intensity2'
						},
						{
							name: 'Jump squats',
							baseRounds: 12,
							intensity: 'intensity4'
						},
						{
							name: 'Lunges',
							baseRounds: 12,
							intensity: 'intensity2'
						},
						{
							name: 'Glute bridge',
							baseRounds: 12,
							intensity: 'intensity2'
						},
						{
							name: 'Mountain climbers',
							baseRounds: 16,
							intensity: 'intensity3'
						},
						{
							name: 'Tricep dips',
							baseRounds: 12,
							intensity: 'intensity2'
						},
					];

					const randExercises = getRandomArrayIndex(currentWorkoutDifficulty.exercises);
					const numberOfExercisesToday = currentWorkoutDifficulty.exercises[randExercises];

					const todaysExercises = [];
					let simpleExerciseClone = structuredClone(simpleExercises);

					for (var index = 0; index < numberOfExercisesToday; index++) {
						let exerciseIndex = Math.floor((Math.random() * simpleExerciseClone.length));
						
						let exerciseEntry = simpleExerciseClone.splice(exerciseIndex, 1);
						let selectedExercise = exerciseEntry[0];
						console.log(selectedExercise)
						console.log(simpleExerciseClone)

						if(capacity == 0) {
							selectedExercise.baseRounds = Math.floor(selectedExercise.baseRounds * 0.8);
						}

						if(capacity == 2) {
							selectedExercise.baseRounds = Math.floor(selectedExercise.baseRounds * 1.2)
						}

						const randomRepsVariation = Math.floor((Math.random() * 5)) - 4 + +capacity;
						selectedExercise.baseRounds = (selectedExercise.baseRounds + randomRepsVariation);

						todaysExercises.push(selectedExercise);
					}

					this.todaysWorkout = todaysExercises;
				},
			};
		}

		function getRandomArrayIndex(array) {
			const arrIndex = Math.floor((Math.random() * array.length));
			return arrIndex;
		}
	</script>
</html>